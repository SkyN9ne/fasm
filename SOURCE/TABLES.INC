
get_operator:
	lodsb
	cmp	al,20h
	je	get_operator
	dec	esi
	mov	edx,esi
      check_operator:
	mov	esi,edx
	movzx	ecx,byte [edi]
	jecxz	no_operator
	inc	edi
	mov	ebx,edi
	add	ebx,ecx
	mov	eax,ecx
	repe	cmpsb
	je	operator_found
	mov	edi,ebx
	inc	edi
	jmp	check_operator
      no_operator:
	xor	al,al
	mov	esi,edx
	ret
      operator_found:
	mov	ebx,edi
	cmp	eax,1
	je	operator_ok
	mov	al,[esi]
	mov	edi,special_characters+1
	movzx	ecx,[special_characters]
	repne	scasb
	jne	no_operator
      operator_ok:
	mov	al,[ebx]
	ret
get_register:
	lodsb
	cmp	al,20h
	je	get_register
	dec	esi
	mov	edx,esi
      check_register:
	mov	esi,edx
	movzx	ecx,byte [edi]
	jecxz	no_register
	inc	edi
	mov	ebx,edi
	add	ebx,ecx
	mov	eax,ecx
	repe	cmpsb
	je	register_found
      next_register:
	mov	edi,ebx
	inc	edi
	jmp	check_register
      no_register:
	mov	esi,edx
	stc
	ret
      register_found:
	mov	ebx,edi
	mov	al,[esi]
	mov	edi,special_characters+1
	movzx	ecx,[special_characters]
	repne	scasb
	jne	next_register
	mov	al,[ebx]
	clc
	ret
get_instruction:
	mov	edx,esi
	mov	ebp,ecx
      check_instruction:
	mov	esi,edx
	movzx	eax,byte [edi]
	or	al,al
	jz	no_instruction
	mov	ecx,ebp
	inc	edi
	mov	ebx,edi
	add	ebx,eax
	cmp	cl,al
	jne	next_instruction
	repe	cmpsb
	je	instruction_ok
      next_instruction:
	mov	edi,ebx
	add	edi,5
	jmp	check_instruction
      no_instruction:
	mov	esi,edx
	stc
	ret
      instruction_ok:
	mov	al,[ebx]
	mov	ebx,[ebx+1]
	clc
	ret

special_characters db 16
 db 0,' +-/*:=()[]{},;'

operators:
 db 1,'+',10h
 db 1,'-',11h
 db 1,'*',20h
 db 1,'/',21h
 db 3,'mod',30h
 db 3,'and',40h
 db 2,'or',41h
 db 3,'xor',42h
 db 3,'shl',60h
 db 3,'shr',61h
 db 0

single_operand_operators:
 db 3,'not',50h
 db 0

size_operators:
 db 4,'byte',1
 db 4,'word',2
 db 5,'dword',4
 db 5,'pword',6
 db 5,'qword',8
 db 5,'tbyte',10
 db 0

jump_operators:
 db 4,'near',1
 db 3,'far',2
 db 0

special_operators:
 db 2,'at',1
 db 0

code_types:
 db 2,'16',16
 db 2,'32',32
 db 0

index_registers:
 db 3,'eax',40h
 db 3,'ecx',41h
 db 3,'edx',42h
 db 3,'ebx',43h
 db 3,'esp',44h
 db 3,'ebp',45h
 db 3,'esi',46h
 db 3,'edi',47h
 db 2,'bx',23h
 db 2,'bp',25h
 db 2,'si',26h
 db 2,'di',27h
 db 0

general_registers:
 db 3,'eax',40h
 db 3,'ecx',41h
 db 3,'edx',42h
 db 3,'ebx',43h
 db 3,'esp',44h
 db 3,'ebp',45h
 db 3,'esi',46h
 db 3,'edi',47h
 db 2,'al',10h
 db 2,'cl',11h
 db 2,'dl',12h
 db 2,'bl',13h
 db 2,'ah',14h
 db 2,'ch',15h
 db 2,'dh',16h
 db 2,'bh',17h
 db 2,'ax',20h
 db 2,'cx',21h
 db 2,'dx',22h
 db 2,'bx',23h
 db 2,'sp',24h
 db 2,'bp',25h
 db 2,'si',26h
 db 2,'di',27h
 db 0

segment_registers:
 db 2,'es',1
 db 2,'cs',2
 db 2,'ss',3
 db 2,'ds',4
 db 2,'fs',5
 db 2,'gs',6
 db 0

control_registers:
 db 3,'cr0',0
 db 3,'cr2',2
 db 3,'cr3',3
 db 3,'cr4',4
 db 0

debug_registers:
 db 3,'dr0',0
 db 3,'dr1',1
 db 3,'dr2',2
 db 3,'dr3',3
 db 3,'dr5',5
 db 3,'dr6',6
 db 3,'dr7',7
 db 0

fpu_registers:
 db 2,'st',0
 db 3,'st0',0
 db 3,'st1',1
 db 3,'st2',2
 db 3,'st3',3
 db 3,'st4',4
 db 3,'st5',5
 db 3,'st6',6
 db 3,'st7',7
 db 0

preprocessor_directives:
 db 7,'include',0
 dd include_file
 db 5,'macro',0
 dd define_macro
 db 2,'HF',0
 dd HF_directive
 db 0

macro_directives:
 db 5,'local',0
 dd local_symbols
 db 0

instructions:
 db 3,'mov',0
 dd mov_instruction
 db 3,'cmp',38h
 dd basic_instruction
 db 3,'sub',28h
 dd basic_instruction
 db 3,'add',00h
 dd basic_instruction
 db 3,'int',CDh
 dd int_instruction
 db 4,'int3',CCh
 dd simple_instruction
 db 4,'into',CEh
 dd simple_instruction
 db 4,'iret',CFh
 dd simple_instruction
 db 5,'iretw',CFh
 dd simple_instruction_16bit
 db 5,'iretd',CFh
 dd simple_instruction_32bit
 db 2,'or',08h
 dd basic_instruction
 db 3,'adc',10h
 dd basic_instruction
 db 3,'sbb',18h
 dd basic_instruction
 db 3,'and',20h
 dd basic_instruction
 db 3,'xor',30h
 dd basic_instruction
 db 3,'daa',27h
 dd simple_instruction
 db 3,'das',2Fh
 dd simple_instruction
 db 3,'aaa',37h
 dd simple_instruction
 db 3,'aas',3Fh
 dd simple_instruction
 db 5,'pusha',60h
 dd simple_instruction
 db 4,'popa',61h
 dd simple_instruction
 db 6,'pushaw',60h
 dd simple_instruction_16bit
 db 5,'popaw',61h
 dd simple_instruction_16bit
 db 6,'pushad',60h
 dd simple_instruction_32bit
 db 5,'popad',61h
 dd simple_instruction_32bit
 db 3,'ins',0
 dd ins_instruction
 db 4,'insb',6Ch
 dd simple_instruction
 db 4,'insw',6Dh
 dd simple_instruction_16bit
 db 4,'insd',6Dh
 dd simple_instruction_32bit
 db 4,'outs',0
 dd outs_instruction
 db 5,'outsb',6Eh
 dd simple_instruction
 db 5,'outsw',6Fh
 dd simple_instruction_16bit
 db 5,'outsd',6Fh
 dd simple_instruction_32bit
 db 3,'nop',90h
 dd simple_instruction
 db 4,'wait',9Bh
 dd simple_instruction
 db 5,'pushf',9Ch
 dd simple_instruction
 db 6,'pushfw',9Ch
 dd simple_instruction_16bit
 db 6,'pushfd',9Ch
 dd simple_instruction_32bit
 db 4,'popf',9Dh
 dd simple_instruction
 db 5,'popfw',9Dh
 dd simple_instruction_16bit
 db 5,'popfd',9Dh
 dd simple_instruction_32bit
 db 4,'sahf',9Eh
 dd simple_instruction
 db 4,'lahf',9Fh
 dd simple_instruction
 db 3,'cbw',98h
 dd simple_instruction_16bit
 db 4,'cwde',98h
 dd simple_instruction_32bit
 db 3,'cwd',99h
 dd simple_instruction_16bit
 db 3,'cdq',99h
 dd simple_instruction_32bit
 db 4,'movs',0
 dd movs_instruction
 db 5,'movsb',A4h
 dd simple_instruction
 db 5,'movsw',A5h
 dd simple_instruction_16bit
 db 5,'movsd',A5h
 dd simple_instruction_32bit
 db 4,'cmps',0
 dd cmps_instruction
 db 5,'cmpsb',A6h
 dd simple_instruction
 db 5,'cmpsw',A7h
 dd simple_instruction_16bit
 db 5,'cmpsd',A7h
 dd simple_instruction_32bit
 db 4,'stos',AAh
 dd stos_instruction
 db 5,'stosb',AAh
 dd simple_instruction
 db 5,'stosw',ABh
 dd simple_instruction_16bit
 db 5,'stosd',ABh
 dd simple_instruction_32bit
 db 4,'lods',0
 dd lods_instruction
 db 5,'lodsb',ACh
 dd simple_instruction
 db 5,'lodsw',ADh
 dd simple_instruction_16bit
 db 5,'lodsd',ADh
 dd simple_instruction_32bit
 db 4,'scas',AEh
 dd stos_instruction
 db 5,'scasb',AEh
 dd simple_instruction
 db 5,'scasw',AFh
 dd simple_instruction_16bit
 db 5,'scasd',AFh
 dd simple_instruction_32bit
 db 4,'xlat',D7h
 dd simple_instruction
 db 4,'lock',F0h
 dd prefix_instruction
 db 3,'rep',F3h
 dd prefix_instruction
 db 4,'repe',F3h
 dd prefix_instruction
 db 4,'repz',F3h
 dd prefix_instruction
 db 5,'repne',F2h
 dd prefix_instruction
 db 5,'repnz',F2h
 dd prefix_instruction
 db 3,'hlt',F4h
 dd simple_instruction
 db 3,'cmc',F5h
 dd simple_instruction
 db 3,'clc',F8h
 dd simple_instruction
 db 3,'stc',F9h
 dd simple_instruction
 db 3,'cli',FAh
 dd simple_instruction
 db 3,'sti',FBh
 dd simple_instruction
 db 3,'cld',FCh
 dd simple_instruction
 db 3,'std',FDh
 dd simple_instruction
 db 4,'push',0
 dd push_instruction
 db 3,'pop',0
 dd pop_instruction
 db 3,'inc',0
 dd inc_instruction
 db 3,'dec',1
 dd inc_instruction
 db 5,'bound',0
 dd bound_instruction
 db 4,'arpl',0
 dd arpl_instruction
 db 2,'jo',70h
 dd conditional_jump
 db 3,'jno',71h
 dd conditional_jump
 db 2,'jc',72h
 dd conditional_jump
 db 2,'jb',72h
 dd conditional_jump
 db 4,'jnae',72h
 dd conditional_jump
 db 3,'jnc',73h
 dd conditional_jump
 db 3,'jnb',73h
 dd conditional_jump
 db 3,'jae',73h
 dd conditional_jump
 db 2,'je',74h
 dd conditional_jump
 db 2,'jz',74h
 dd conditional_jump
 db 3,'jne',75h
 dd conditional_jump
 db 3,'jnz',75h
 dd conditional_jump
 db 3,'jna',76h
 dd conditional_jump
 db 3,'jbe',76h
 dd conditional_jump
 db 2,'ja',77h
 dd conditional_jump
 db 4,'jnbe',77h
 dd conditional_jump
 db 2,'js',78h
 dd conditional_jump
 db 3,'jns',79h
 dd conditional_jump
 db 2,'jp',7Ah
 dd conditional_jump
 db 3,'jpe',7Ah
 dd conditional_jump
 db 3,'jnp',7Bh
 dd conditional_jump
 db 3,'jpo',7Bh
 dd conditional_jump
 db 2,'jl',7Ch
 dd conditional_jump
 db 4,'jnge',7Ch
 dd conditional_jump
 db 3,'jnl',7Dh
 dd conditional_jump
 db 3,'jge',7Dh
 dd conditional_jump
 db 3,'jng',7Eh
 dd conditional_jump
 db 3,'jle',7Eh
 dd conditional_jump
 db 2,'jg',7Fh
 dd conditional_jump
 db 4,'jnle',7Fh
 dd conditional_jump
 db 4,'jcxz',0
 dd jcxz_instruction
 db 5,'jecxz',0
 dd jecxz_instruction
 db 4,'loop',E2h
 dd loop_instruction
 db 5,'loope',E1h
 dd loop_instruction
 db 5,'loopz',E1h
 dd loop_instruction
 db 6,'loopne',E0h
 dd loop_instruction
 db 6,'loopnz',E0h
 dd loop_instruction
 db 5,'loopw',E2h
 dd loop_instruction_16bit
 db 6,'loopew',E1h
 dd loop_instruction_16bit
 db 6,'loopzw',E1h
 dd loop_instruction_16bit
 db 7,'loopnew',E0h
 dd loop_instruction_16bit
 db 7,'loopnzw',E0h
 dd loop_instruction_16bit
 db 5,'loopd',E2h
 dd loop_instruction_32bit
 db 6,'looped',E1h
 dd loop_instruction_32bit
 db 6,'loopzd',E1h
 dd loop_instruction_32bit
 db 7,'loopned',E0h
 dd loop_instruction_32bit
 db 7,'loopnzd',E0h
 dd loop_instruction_32bit
 db 4,'call',0
 dd call_instruction
 db 3,'jmp',0
 dd jmp_instruction
 db 3,'ret',0
 dd ret_instruction
 db 4,'retn',0
 dd ret_instruction
 db 4,'retf',0
 dd retf_instruction
 db 4,'test',0
 dd test_instruction
 db 4,'xchg',0
 dd xchg_instruction
 db 3,'lea',0
 dd lea_instruction
 db 3,'les',0
 dd ls_instruction
 db 3,'lcs',1
 dd ls_instruction
 db 3,'lss',2
 dd ls_instruction
 db 3,'lds',3
 dd ls_instruction
 db 3,'lfs',4
 dd ls_instruction
 db 3,'lgs',5
 dd ls_instruction
 db 5,'enter',0
 dd enter_instruction
 db 5,'leave',C9h
 dd simple_instruction
 db 3,'not',2
 dd single_operand_instruction
 db 3,'neg',3
 dd single_operand_instruction
 db 3,'mul',4
 dd single_operand_instruction
 db 3,'div',6
 dd single_operand_instruction
 db 4,'idiv',7
 dd single_operand_instruction
 db 4,'imul',0
 dd imul_instruction
 db 3,'rol',0
 dd sh_instruction
 db 3,'ror',1
 dd sh_instruction
 db 3,'rcl',2
 dd sh_instruction
 db 3,'rcr',3
 dd sh_instruction
 db 3,'shl',4
 dd sh_instruction
 db 3,'shr',5
 dd sh_instruction
 db 3,'sal',6
 dd sh_instruction
 db 3,'sar',7
 dd sh_instruction
 db 2,'in',0
 dd in_instruction
 db 3,'out',0
 dd out_instruction
 db 4,'seto',90h
 dd set_instruction
 db 5,'setno',91h
 dd set_instruction
 db 4,'setc',92h
 dd set_instruction
 db 4,'setb',92h
 dd set_instruction
 db 6,'setnae',92h
 dd set_instruction
 db 5,'setnc',93h
 dd set_instruction
 db 5,'setnb',93h
 dd set_instruction
 db 5,'setae',93h
 dd set_instruction
 db 4,'sete',94h
 dd set_instruction
 db 4,'setz',94h
 dd set_instruction
 db 5,'setne',95h
 dd set_instruction
 db 5,'setnz',95h
 dd set_instruction
 db 5,'setna',96h
 dd set_instruction
 db 5,'setbe',96h
 dd set_instruction
 db 4,'seta',97h
 dd set_instruction
 db 6,'setnbe',97h
 dd set_instruction
 db 4,'sets',98h
 dd set_instruction
 db 5,'setns',99h
 dd set_instruction
 db 4,'setp',9Ah
 dd set_instruction
 db 5,'setpe',9Ah
 dd set_instruction
 db 5,'setnp',9Bh
 dd set_instruction
 db 5,'setpo',9Bh
 dd set_instruction
 db 4,'setl',9Ch
 dd set_instruction
 db 6,'setnge',9Ch
 dd set_instruction
 db 5,'setnl',9Dh
 dd set_instruction
 db 5,'setge',9Dh
 dd set_instruction
 db 5,'setng',9Eh
 dd set_instruction
 db 5,'setle',9Eh
 dd set_instruction
 db 4,'setg',9Fh
 dd set_instruction
 db 6,'setnle',9Fh
 dd set_instruction
 db 4,'shld',A4h
 dd shd_instruction
 db 4,'shrd',ACh
 dd shd_instruction
 db 5,'movzx',B6h
 dd movx_instruction
 db 5,'movsx',BEh
 dd movx_instruction
 db 6,'setalc',D6h
 dd simple_instruction
 db 2,'bt',4
 dd bt_instruction
 db 3,'bts',5
 dd bt_instruction
 db 3,'btr',6
 dd bt_instruction
 db 3,'btc',7
 dd bt_instruction
 db 3,'bsf',BCh
 dd bs_instruction
 db 3,'bsr',BDh
 dd bs_instruction
 db 4,'clts',6
 dd simple_extended_instruction
 db 4,'invd',8
 dd simple_extended_instruction
 db 6,'wbinvd',9
 dd simple_extended_instruction
 db 5,'wrmsr',30h
 dd simple_extended_instruction
 db 5,'rdtsc',31h
 dd simple_extended_instruction
 db 5,'rdmsr',32h
 dd simple_extended_instruction
 db 3,'rsm',AAh
 dd simple_extended_instruction
 db 4,'sldt',0
 dd pm_word_instruction
 db 3,'str',1
 dd pm_word_instruction
 db 4,'lldt',2
 dd pm_word_instruction
 db 3,'ltr',3
 dd pm_word_instruction
 db 4,'verr',4
 dd pm_word_instruction
 db 4,'verw',5
 dd pm_word_instruction
 db 4,'smsw',14h
 dd pm_word_instruction
 db 4,'lmsw',16h
 dd pm_word_instruction
 db 4,'sgdt',0
 dd pm_pword_instruction
 db 4,'sidt',1
 dd pm_pword_instruction
 db 4,'lgdt',2
 dd pm_pword_instruction
 db 4,'lidt',3
 dd pm_pword_instruction
 db 3,'lar',2
 dd lar_instruction
 db 3,'lsl',3
 dd lar_instruction
 db 6,'invlpg',0
 dd invlpg_instruction
 db 7,'cmpxchg',B0h
 dd basic_486_instruction
 db 4,'xadd',C0h
 dd basic_486_instruction
 db 5,'bswap',0
 dd bswap_instruction
 db 9,'cmpxchg8b',0
 dd cmpxchg8b_instruction
 db 5,'cpuid',A2h
 dd simple_extended_instruction
 db 4,'fadd',0
 dd basic_fpu_instruction
 db 4,'fmul',1
 dd basic_fpu_instruction
 db 4,'fcom',2
 dd basic_fpu_instruction
 db 5,'fcomp',3
 dd basic_fpu_instruction
 db 4,'fsub',4
 dd basic_fpu_instruction
 db 5,'fsubr',5
 dd basic_fpu_instruction
 db 4,'fdiv',6
 dd basic_fpu_instruction
 db 5,'fdivr',7
 dd basic_fpu_instruction
 db 4,'fnop',010000b
 dd simple_fpu_instruction
 db 4,'fchs',100000b
 dd simple_fpu_instruction
 db 4,'fabs',100001b
 dd simple_fpu_instruction
 db 4,'ftst',100100b
 dd simple_fpu_instruction
 db 4,'fxam',100101b
 dd simple_fpu_instruction
 db 4,'fld1',101000b
 dd simple_fpu_instruction
 db 6,'fldl2t',101001b
 dd simple_fpu_instruction
 db 6,'fldl2e',101010b
 dd simple_fpu_instruction
 db 5,'fldpi',101011b
 dd simple_fpu_instruction
 db 6,'fldlg2',101100b
 dd simple_fpu_instruction
 db 6,'fldln2',101101b
 dd simple_fpu_instruction
 db 4,'fldz',101110b
 dd simple_fpu_instruction
 db 5,'f2xm1',110000b
 dd simple_fpu_instruction
 db 5,'fyl2x',110001b
 dd simple_fpu_instruction
 db 5,'fptan',110010b
 dd simple_fpu_instruction
 db 6,'fpatan',110011b
 dd simple_fpu_instruction
 db 7,'fxtract',110100b
 dd simple_fpu_instruction
 db 6,'fprem1',110101b
 dd simple_fpu_instruction
 db 7,'fdecstp',110110b
 dd simple_fpu_instruction
 db 7,'fincstp',110111b
 dd simple_fpu_instruction
 db 5,'fprem',111000b
 dd simple_fpu_instruction
 db 7,'fyl2xp1',111001b
 dd simple_fpu_instruction
 db 5,'fsqrt',111010b
 dd simple_fpu_instruction
 db 7,'fsincos',111011b
 dd simple_fpu_instruction
 db 7,'frndint',111100b
 dd simple_fpu_instruction
 db 6,'fscale',111101b
 dd simple_fpu_instruction
 db 4,'fsin',111110b
 dd simple_fpu_instruction
 db 4,'fcos',111111b
 dd simple_fpu_instruction
 db 5,'fiadd',0
 dd fi_instruction
 db 5,'fimul',1
 dd fi_instruction
 db 5,'ficom',2
 dd fi_instruction
 db 6,'ficomp',3
 dd fi_instruction
 db 5,'fisub',4
 dd fi_instruction
 db 6,'fisubr',5
 dd fi_instruction
 db 5,'fidiv',6
 dd fi_instruction
 db 6,'fidivr',7
 dd fi_instruction
 db 3,'fld',0
 dd fld_instruction
 db 3,'fst',2
 dd fld_instruction
 db 4,'fstp',3
 dd fld_instruction
 db 4,'fild',0
 dd fild_instruction
 db 4,'fist',2
 dd fild_instruction
 db 5,'fistp',3
 dd fild_instruction
 db 4,'fbld',4
 dd fbld_instruction
 db 5,'fbstp',6
 dd fbld_instruction
 db 5,'faddp',0
 dd faddp_instruction
 db 5,'fmulp',1
 dd faddp_instruction
 db 5,'fsubp',4
 dd faddp_instruction
 db 6,'fsubrp',5
 dd faddp_instruction
 db 5,'fdivp',6
 dd faddp_instruction
 db 6,'fdivrp',7
 dd faddp_instruction
 db 6,'fcompp',0
 dd fcompp_instruction
 db 4,'fxch',1
 dd fxch_instruction
 db 5,'ffree',0
 dd ffree_instruction
 db 5,'fucom',4
 dd ffree_instruction
 db 6,'fucomp',5
 dd ffree_instruction
 db 6,'fldenv',4
 dd fldenv_instruction
 db 6,'fstenv',6
 dd fldenv_instruction
 db 5,'fldcw',5
 dd fldcw_instruction
 db 5,'fstcw',7
 dd fldcw_instruction
 db 5,'fsave',6
 dd fsave_instruction
 db 6,'frstor',4
 dd fsave_instruction
 db 5,'fstsw',0
 dd fstsw_instruction
 db 5,'fclex',E2h
 dd finit_instruction
 db 5,'finit',E3h
 dd finit_instruction
 db 2,'es',26h
 dd prefix_instruction
 db 2,'cs',2Eh
 dd prefix_instruction
 db 2,'ss',36h
 dd prefix_instruction
 db 2,'ds',3Eh
 dd prefix_instruction
 db 2,'fs',64h
 dd prefix_instruction
 db 2,'gs',65h
 dd prefix_instruction
 db 3,'org',0
 dd org_directive
 db 4,'code',0
 dd code_directive
 db 5,'label',0
 dd label_directive
 db 5,'times',0
 dd times_directive
 db 5,'entry',0
 dd entry_directive
data_instructions:
 db 2,'db',1
 dd data_bytes
 db 2,'dw',2
 dd data_words
 db 2,'dd',4
 dd data_dwords
 db 2,'dp',6
 dd data_pwords
 db 2,'dq',8
 dd data_qwords
 db 2,'rb',1
 dd reserve_bytes
 db 2,'rw',2
 dd reserve_words
 db 2,'rd',4
 dd reserve_dwords
 db 2,'rp',6
 dd reserve_pwords
 db 2,'rq',8
 dd reserve_qwords
 db 4,'file',1
 dd data_file
 db 0
